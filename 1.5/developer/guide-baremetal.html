<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.13"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>WRENCH: Bare-Metal</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
    <!-- SmartMenus jQuery plugin -->
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="http://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.5
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li><a href="index.html">Overview</a></li>
                <li><a href="install.html">Installation</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="wrench-101.html">WRENCH 101</a></li>
                <li><a href="guide.html">Guide</a></li>
                <li><a href="annotated.html">API Reference</a></li>
                <li style="float: right">
                    <input type="hidden" id="MSearchField">
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Bare-Metal </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#guide-baremetal-overview">Overview</a></li>
<li class="level1"><a href="#guide-baremetal-creating">Creating a bare-metal compute service</a><ul><li class="level2"><a href="#guide-baremetal-creating-properties">Bare-metal service properties</a></li>
</ul>
</li>
<li class="level1"><a href="#guide-baremetal-using">Submitting jobs to a bare-metal compute service</a></li>
</ul>
</div>
<div class="textblock"><div class="doc-type">Developer Documentation</div><div class="doc-link">Other: <a href="../user/guide-baremetal.html">User</a> - <a href="../internal/guide-baremetal.html">Internal</a></div><h1><a class="anchor" id="guide-baremetal-overview"></a>
Overview</h1>
<p>A bare-metal is a service that makes it possible to run directly jobs on hardware resources. Think of it as a set of multi-core hosts on which multi-threaded processes can be started using something like Ssh. The service does not perform any space-sharing among the jobs. In other words, jobs submitted to the service execute concurrently in a time-shared manner. It is the responsibility of the job submitter to pick hosts and/or numbers of cores for each task, e.g., to enforce space-sharing of cores. The only resource allocation performed by the service is that it ensures that the RAM capacity of a host is not exceeded. Tasks that have non-zero RAM requirements are queued in FCFS fashion at each host until there is enough RAM to execute them (think of this as each host running an OS that disallows swapping and implements a FCFS access policy for RAM allocation).</p>
<h1><a class="anchor" id="guide-baremetal-creating"></a>
Creating a bare-metal compute service</h1>
<p>In WRENCH, a bare-metal service represents a compute service (<code><a class="el" href="classwrench_1_1_compute_service.html" title="The compute service base class. ">wrench::ComputeService</a></code>), which is defined by the <code><a class="el" href="classwrench_1_1_bare_metal_compute_service.html" title="A compute service that manages a set of multi-core compute hosts and provides access to their resourc...">wrench::BareMetalComputeService</a></code> class. An instantiation of a bare-metal service requires the following parameters:</p>
<ul>
<li>The name of a host on which to start the service (this is the entry point to the service);</li>
<li>A set of compute hosts in a map (<code>std::map</code>), where each key is a hostname and each value is a tuple (<code>std::tuple</code>) with a number of cores and a RAM capacity.</li>
<li>A mount point (corresponding to a disk attached to the host) for the scratch space, i.e., storage local to the bare-metal service (used to store workflow files, as needed, during job executions)</li>
<li>Maps (<code>std::map</code>) of configurable properties (<code><a class="el" href="classwrench_1_1_bare_metal_compute_service_property.html" title="Configurable properties for a BareMetalComputeService. ">wrench::BareMetalComputeServiceProperty</a></code>) and configurable message payloads (<code><a class="el" href="classwrench_1_1_bare_metal_compute_service_message_payload.html" title="Configurable message payloads for a MultiHostMulticoreComputeService. ">wrench::BareMetalComputeServiceMessagePayload</a></code>).</li>
</ul>
<p>The example below shows how to create an instance of a bare-metal service that runs on host "Gateway", provides access to 4 cores and 1GiB of RAM on host "Node1" and to 8 cores and 4GiB of RAM on host "Node2", and has a scratch space of 1TiB. Furthermore, the thread startup overhead is configured to be one hundredth of a second:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> baremetal_cs = simulation-&gt;add(</div><div class="line">          <span class="keyword">new</span> <a class="code" href="classwrench_1_1_bare_metal_compute_service.html">wrench::BareMetalComputeService</a>(<span class="stringliteral">&quot;Gateway&quot;</span>, </div><div class="line">                                       {{<span class="stringliteral">&quot;Node1&quot;</span>, std::make_tuple(4, pow(2,30))}, {<span class="stringliteral">&quot;Node2&quot;</span>, std::make_tuple(8, pow(2,32)}},</div><div class="line">                                       <span class="stringliteral">&quot;/scratch/&quot;</span>,</div><div class="line">                                       {{wrench::BareMetalComputeServiceProperty::THREAD_STARTUP_OVERHEAD, <span class="stringliteral">&quot;0.01&quot;</span>}}, </div><div class="line">                                       {});</div></div><!-- fragment --><h2><a class="anchor" id="guide-baremetal-creating-properties"></a>
Bare-metal service properties</h2>
<p>In addition to properties inherited from <code><a class="el" href="classwrench_1_1_compute_service_property.html" title="Configurable properties for a ComputeService. ">wrench::ComputeServiceProperty</a></code>, a bare-metal service supports the following properties:</p>
<ul>
<li><code>wrench::BareMetalComputeServiceProperty::THREAD_STARTUP_OVERHEAD</code></li>
</ul>
<h1><a class="anchor" id="guide-baremetal-using"></a>
Submitting jobs to a bare-metal compute service</h1>
<p>As expected, a bare-metal service provides implementations of the methods in the <code><a class="el" href="classwrench_1_1_compute_service.html" title="The compute service base class. ">wrench::ComputeService</a></code> base class. The <code><a class="el" href="classwrench_1_1_compute_service.html#abc9e51234c29965341727f07b446ff0c" title="Submit a job to the compute service. ">wrench::ComputeService::submitJob()</a></code> method takes as argument service-specific arguments as a <code>std::map&lt;std::string, std::string&gt;</code> of key-value pairs. The key is a task ID, and the value is the service-specific argument for that task. When submitting a job to a bare-metal service, arguments can be specified a follows.</p>
<p>For each task, an optional argument can be provided as a string formatted as "hostname:num_cores", "hostname", or "num_cores", where "hostname" is the name of one of the service's compute hosts and "num_cores" is an integer (e.g., "host1:10", "host1", "10"):</p>
<ul>
<li>If no value is provided for a task, or if the value is the empty string, then the bare-metal service will choose the host on which the task should be executed (typically the host with the lowest current load), and will execute the task with as many cores as possible on that host.</li>
<li>If a "hostname" value is provided for a task, then the bare-metal service will execute the task on that host, and will execute the task with as many cores as possible on that host.</li>
<li>If a "num_cores" value is provided for a task, then the bare-metal service will choose the host on which the task should be executed (typically the host with the lowest current load), and will execute the task with the specified number of cores.</li>
<li>If a "hostname:num_cores" value is provided for a task, then the bare-metal service will execute the task on that host with the specified number of cores.</li>
</ul>
<p>Here is an example submission to the bare-metal service created in the above example, for a 4-task job for tasks with IDs "task1", "task2", "task3", and "task4":</p>
<div class="fragment"><div class="line"><span class="comment">// Create a job manager</span></div><div class="line"><span class="keyword">auto</span> job_manager = this-&gt;createJobManager();</div><div class="line"></div><div class="line"><span class="comment">// Create a job</span></div><div class="line"><span class="keyword">auto</span> job = job_manager-&gt;createStandardJob(</div><div class="line">                 {this-&gt;getWorklow()-&gt;getTaskByID(<span class="stringliteral">&quot;task1&quot;</span>),</div><div class="line">                  this-&gt;getWorklow()-&gt;getTaskByID(<span class="stringliteral">&quot;task2&quot;</span>),</div><div class="line">                  this-&gt;getWorklow()-&gt;getTaskByID(<span class="stringliteral">&quot;task3&quot;</span>),</div><div class="line">                  this-&gt;getWorklow()-&gt;getTaskByID(<span class="stringliteral">&quot;task4&quot;</span>)}, {});</div><div class="line"></div><div class="line"><span class="comment">// Create service-specific arguments so that:</span></div><div class="line"><span class="comment">//   task1 will run on host Node1 with as many cores as possible</span></div><div class="line"><span class="comment">//   task2 will run on host Node2 with 16 cores</span></div><div class="line"><span class="comment">//   task3 will run on some host with as many cores as possible</span></div><div class="line"><span class="comment">//   task4 will run on some host with 4 cores</span></div><div class="line">std::map&lt;std::string, std::string&gt; service_specific_args;</div><div class="line">service_specific_args[<span class="stringliteral">&quot;task1&quot;</span>] = <span class="stringliteral">&quot;Node1&quot;</span>;</div><div class="line">service_specific_args[<span class="stringliteral">&quot;task2&quot;</span>] = <span class="stringliteral">&quot;Node2:16&quot;</span>;</div><div class="line">service_specific_args[<span class="stringliteral">&quot;task4&quot;</span>] = <span class="stringliteral">&quot;4&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">// Submit the job</span></div><div class="line">job_manager-&gt;submitJob(job, baremetal_cs, service_specific_args);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer">
    <small>
        Generated by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
    </a> 1.8.13
    </small>
</address>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
