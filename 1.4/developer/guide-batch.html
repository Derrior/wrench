<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.6"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>WRENCH: Batch</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
    <!-- SmartMenus jQuery plugin -->
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="http://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.4
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li><a href="index.html">Overview</a></li>
                <li><a href="install.html">Installation</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="wrench-101.html">WRENCH 101</a></li>
                <li><a href="guide.html">Guide</a></li>
                <li><a href="annotated.html">API Reference</a></li>
                <li style="float: right">
                    <input type="hidden" id="MSearchField">
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Batch </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#guide-batch-overview">Overview</a></li>
<li class="level1"><a href="#guide-batch-creating">Creating a batch compute service</a><ul><li class="level2"><a href="#guide-baremetal-creating-properties">Bare-metal service properties</a></li>
</ul>
</li>
<li class="level1"><a href="#guide-batch-using">Submitting jobs to a batch compute service</a></li>
</ul>
</div>
<div class="textblock"><div class="doc-type">Developer Documentation</div><div class="doc-link">Other: <a href="../user/guide-batch.html">User</a> - <a href="../internal/guide-batch.html">Internal</a></div><h1><a class="anchor" id="guide-batch-overview"></a>
Overview</h1>
<p>A batch service is a service that makes it possible to run workflow jobs on a homogeneous cluster managed by a batch scheduler. The batch scheduler receives requests that ask for a number of compute nodes, with a number of cores per compute node, and a duration. Requests wait in a queue and, using a range of possible batch scheduling algorithms, are dispatched to the requested compute resources in a space-sharing manner. Therefore, a job submitted to the service experiences a "queue waiting time" period (the length of which depends on the load on the service) followed by an "execution time" period. In typical batch-scheduler fashion, a running job is cleanly_terminated when it reaches its requested duration, which may cause the job to fail. If, instead, the job completes before the requested duration the job succeeds. In both cases, the job's allocated compute resources are reclaimed by the batch scheduler.</p>
<p>A batch service also supports so-called "pilot jobs", i.e., jobs that are submitted to the service, with requested resources and duration, but without specifying at submission time which workflow tasks/operations should be performed by the job. Instead, once the job starts it exposes to its submitter a <a class="el" href="guide-baremetal.html">Bare-metal</a> service. This service is available only for the requested duration, and can be used in any manner by the submitter. This allows late binding of workflow tasks to compute resources.</p>
<h1><a class="anchor" id="guide-batch-creating"></a>
Creating a batch compute service</h1>
<p>In WRENCH, a batch service represents a compute service (<code><a class="el" href="classwrench_1_1_compute_service.html" title="The compute service base class. ">wrench::ComputeService</a></code>), which is defined by the <code><a class="el" href="classwrench_1_1_batch_service.html" title="A batch-scheduled compute service that manages a set of compute hosts and controls access to their re...">wrench::BatchService</a></code> class. An instantiation of a batch service requires the following parameters:</p>
<ul>
<li>A hostname on which to start the service (this is the entry point to the service)</li>
<li>A list (<code>std::vector</code>) of hostnames (all cores and all RAM of each host is available to the batch service)</li>
<li>A scratch space size, i.e., the size in bytes of storage local to the batch service (used to store workflow files, as needed, during job executions)</li>
<li>Maps (<code>std::map</code>) of configurable properties (<code><a class="el" href="classwrench_1_1_batch_service_property.html" title="Configurable properties for a BatchService. ">wrench::BatchServiceProperty</a></code>) and configurable message payloads (<code><a class="el" href="classwrench_1_1_batch_service_message_payload.html" title="Configurable message payloads for a BatchService. ">wrench::BatchServiceMessagePayload</a></code>)</li>
</ul>
<p>The example below shows how to create an instance of a batch service that runs on host "Gateway" and provides access to 4 hosts (using all their cores and RAM), with 1 TiB scratch space. Furthermore, the batch scheduling algorithm is configured to the FCFS (First-Come-First-Serve):</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> batch_cs = simulation-&gt;add(</div>
<div class="line">          <span class="keyword">new</span> <a class="code" href="classwrench_1_1_batch_service.html">wrench::BatchService</a>(<span class="stringliteral">&quot;Gateway&quot;</span>, </div>
<div class="line">                                   {<span class="stringliteral">&quot;Node1&quot;</span>, <span class="stringliteral">&quot;Node2&quot;</span>, <span class="stringliteral">&quot;Node3&quot;</span>, <span class="stringliteral">&quot;Node4&quot;</span>},</div>
<div class="line">                                   pow(2,40),</div>
<div class="line">                                   {{<a class="code" href="classwrench_1_1_batch_service_property.html#aceb0af1c33f5ff2da347f54a484ce32e">wrench::BatchServiceProperty::BATCH_SCHEDULING_ALGORITHM</a>, <span class="stringliteral">&quot;FCFS&quot;</span>}},</div>
<div class="line">                                   {});</div>
</div><!-- fragment --><h2><a class="anchor" id="guide-baremetal-creating-properties"></a>
Bare-metal service properties</h2>
<p>In addition to properties inherited from <code><a class="el" href="classwrench_1_1_compute_service_property.html" title="Configurable properties for a ComputeService. ">wrench::ComputeServiceProperty</a></code>, a batch compute service supports the following properties:</p>
<ul>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#ad60a71526e251e20cbd871e5d30e5023" title="The overhead to start a thread execution, in seconds. ">wrench::BatchServiceProperty::THREAD_STARTUP_OVERHEAD</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#af75bbbe70a733d3a65cddc5c57b0b441" title="The host selection algorithm. Can be: ">wrench::BatchServiceProperty::HOST_SELECTION_ALGORITHM</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#aceb0af1c33f5ff2da347f54a484ce32e" title="The batch scheduling algorithm. Can be: ">wrench::BatchServiceProperty::BATCH_SCHEDULING_ALGORITHM</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#a51cc79b2c963a67dac5685fbba4e5a9f" title="The batch queue ordering algorithm. Can be: ">wrench::BatchServiceProperty::BATCH_QUEUE_ORDERING_ALGORITHM</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#a685c9784445ed28adbe43f69ccb98249" title="Number of seconds that the Batch Scheduler adds to the runtime of each incoming job. This is something production batch systems do to avoid too aggressive job terminations. For instance, if a job says it wants to run for (at most) 60 seconds, the system will actually assume the job wants to run for (at most) 60 + 5 seconds. ">wrench::BatchServiceProperty::BATCH_RJMS_DELAY</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#a6a7fb4d9f505cc29f7236ea3e5713f34" title="Path to a workload trace file to be replayed. The trace file can be be in the SWF format (see http://...">wrench::BatchServiceProperty::SIMULATED_WORKLOAD_TRACE_FILE</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#a0757979b1512be80fda90cbab946b51f" title="Path to a to-be-generated Batsim-style CSV trace file (e.g. for b3atch schedule visualization purpose...">wrench::BatchServiceProperty::OUTPUT_CSV_JOB_LOG</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#a0bde5c75f5f093ae15e68d67ae453ac3" title="Simulate computation as just a sleep instead of an actual comput thread. This is for scalability reas...">wrench::BatchServiceProperty::SIMULATE_COMPUTATION_AS_SLEEP</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#aaab42384419440aacdbaac79e3346bf1" title="Controls Batsched logging. ">wrench::BatchServiceProperty::BATSCHED_LOGGING_MUTED</a></code></li>
<li><code><a class="el" href="classwrench_1_1_batch_service_property.html#ac21c68a5a297ba00fc919cec0d90c18d" title="Controls Batsched node allocation policy. ">wrench::BatchServiceProperty::BATSCHED_CONTIGUOUS_ALLOCATION</a></code></li>
</ul>
<h1><a class="anchor" id="guide-batch-using"></a>
Submitting jobs to a batch compute service</h1>
<p>As expected, a batch service provides implementations of the methods in the <code><a class="el" href="classwrench_1_1_compute_service.html" title="The compute service base class. ">wrench::ComputeService</a></code> base class. The <code><a class="el" href="classwrench_1_1_compute_service.html#abc9e51234c29965341727f07b446ff0c" title="Submit a job to the compute service. ">wrench::ComputeService::submitJob()</a></code> method takes as argument service-specific arguments as a <code>std::map&lt;std::string, std::string&gt;</code> of key-value pairs. These <b>required</b> arguments are to be specified as follows:</p>
<ul>
<li>key: <code>-t</code>; value: a requested runtime in minutes (if the job execution exceeds this limit, then the job is cleanly_terminated)</li>
<li>key: <code>-N</code>; value: a requested number of compute nodes</li>
<li>key: <code>-c</code>; value: a requested number of cores per compute nodes</li>
</ul>
<p>(You may note the the above corresponds to the arguments that must be provided to <a href="https://slurm.schedmd.com/">SLURM</a>.)</p>
<p>Here is an example job submission to the batch service:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a job manager</span></div>
<div class="line"><span class="keyword">auto</span> job_manager = this-&gt;createJobManager();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create a job</span></div>
<div class="line"><span class="keyword">auto</span> job = job_manager-&gt;createStandardJob(tasks, {});</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create service-specific arguments so that:</span></div>
<div class="line"><span class="comment">//   The job will run no longer than 1 hour</span></div>
<div class="line"><span class="comment">//   The job will run on 2 compute nodes</span></div>
<div class="line"><span class="comment">//   The job will use 4 cores on each compute nodes</span></div>
<div class="line">std::map&lt;std::string, std::string&gt; service_specific_args;</div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-t&quot;</span>] = <span class="stringliteral">&quot;60&quot;</span>;</div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-N&quot;</span>] = <span class="stringliteral">&quot;2&quot;</span>;</div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-c&quot;</span>] = <span class="stringliteral">&quot;4&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Submit the job</span></div>
<div class="line">job_manager-&gt;submitJob(job, batch_cs, service_specific_args);</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer">
    <small>
        Generated by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
    </a> 1.8.6
    </small>
</address>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
