Developer DocumentationOther\+: \href{../user/guide-baremetal.html}{\tt User} -\/ \href{../internal/guide-baremetal.html}{\tt Internal}\hypertarget{guide-baremetal_guide-baremetal-overview}{}\section{Overview}\label{guide-baremetal_guide-baremetal-overview}
A bare-\/metal is a service that makes it possible to run directly jobs on hardware resources. Think of it as a set of multi-\/core hosts on which multi-\/threaded processes can be started using something like Ssh. The service does not perform any space-\/sharing among the jobs. In other words, jobs submitted to the service execute concurrently in a time-\/shared manner. It is the responsibility of the job submitter to pick hosts and/or numbers of cores for each task, e.\+g., to enforce space-\/sharing of cores. The only resource allocation performed by the service is that it ensures that the R\+AM capacity of a host is not exceeded. Tasks that have non-\/zero R\+AM requirements are queued in F\+C\+FS fashion at each host until there is enough R\+AM to execute them (think of this as each host running an OS that disallows swapping and implements a F\+C\+FS access policy for R\+AM allocation).\hypertarget{guide-baremetal_guide-baremetal-creating}{}\section{Creating a bare-\/metal compute service}\label{guide-baremetal_guide-baremetal-creating}
In W\+R\+E\+N\+CH, a bare-\/metal service represents a compute service ({\ttfamily \hyperlink{classwrench_1_1_compute_service}{wrench\+::\+Compute\+Service}}), which is defined by the {\ttfamily \hyperlink{classwrench_1_1_bare_metal_compute_service}{wrench\+::\+Bare\+Metal\+Compute\+Service}} class. An instantiation of a bare-\/metal service requires the following parameters\+:


\begin{DoxyItemize}
\item The name of a host on which to start the service (this is the entry point to the service);
\item A set of compute hosts in a map ({\ttfamily std\+::map}), where each key is a hostname and each value is a tuple ({\ttfamily std\+::tuple}) with a number of cores and a R\+AM capacity.
\item A scratch space size, i.\+e., the size in bytes of storage local to the bare-\/metal service (used to store workflow files, as needed, during job executions)
\item Maps ({\ttfamily std\+::map}) of configurable properties ({\ttfamily \hyperlink{classwrench_1_1_bare_metal_compute_service_property}{wrench\+::\+Bare\+Metal\+Compute\+Service\+Property}}) and configurable message payloads ({\ttfamily \hyperlink{classwrench_1_1_bare_metal_compute_service_message_payload}{wrench\+::\+Bare\+Metal\+Compute\+Service\+Message\+Payload}}).
\end{DoxyItemize}

The example below shows how to create an instance of a bare-\/metal service that runs on host \char`\"{}\+Gateway\char`\"{}, provides access to 4 cores and 1\+GiB of R\+AM on host \char`\"{}\+Node1\char`\"{} and to 8 cores and 4\+GiB of R\+AM on host \char`\"{}\+Node2\char`\"{}, and has a scratch space of 1\+TiB. Furthermore, the thread startup overhead is configured to be one hundredth of a second\+:


\begin{DoxyCode}
\textcolor{keyword}{auto} baremetal\_cs = simulation->add(
          \textcolor{keyword}{new} \hyperlink{classwrench_1_1_bare_metal_compute_service}{wrench::BareMetalComputeService}(\textcolor{stringliteral}{"Gateway"}, 
                                       \{\{\textcolor{stringliteral}{"Node1"}, std::make\_tuple(4, pow(2,30))\}, \{\textcolor{stringliteral}{"Node2"}, std::make\_tuple
      (8, pow(2,32)\}\},
                                       pow(2,40),
                                       \{\{
      \hyperlink{classwrench_1_1_bare_metal_compute_service_property_a63dfaa7ebb4dc18d236c58384f14dd25}{wrench::BareMetalComputeServiceProperty::THREAD\_STARTUP\_OVERHEAD}
      , \textcolor{stringliteral}{"0.01"}\}\}, 
                                       \{\});
\end{DoxyCode}
\hypertarget{guide-batch_guide-baremetal-creating-properties}{}\subsection{Bare-\/metal service properties}\label{guide-batch_guide-baremetal-creating-properties}
In addition to properties inherited from {\ttfamily \hyperlink{classwrench_1_1_compute_service_property}{wrench\+::\+Compute\+Service\+Property}}, a bare-\/metal service supports the following properties\+:


\begin{DoxyItemize}
\item {\ttfamily \hyperlink{classwrench_1_1_bare_metal_compute_service_property_a63dfaa7ebb4dc18d236c58384f14dd25}{wrench\+::\+Bare\+Metal\+Compute\+Service\+Property\+::\+T\+H\+R\+E\+A\+D\+\_\+\+S\+T\+A\+R\+T\+U\+P\+\_\+\+O\+V\+E\+R\+H\+E\+AD}}
\end{DoxyItemize}\hypertarget{guide-baremetal_guide-baremetal-using}{}\section{Submitting jobs to a bare-\/metal compute service}\label{guide-baremetal_guide-baremetal-using}
As expected, a bare-\/metal service provides implementations of the methods in the {\ttfamily \hyperlink{classwrench_1_1_compute_service}{wrench\+::\+Compute\+Service}} base class. The {\ttfamily \hyperlink{classwrench_1_1_compute_service_abc9e51234c29965341727f07b446ff0c}{wrench\+::\+Compute\+Service\+::submit\+Job()}} method takes as argument service-\/specific arguments as a {\ttfamily std\+::map$<$std\+::string, std\+::string$>$} of key-\/value pairs. The key is a task ID, and the value is the service-\/specific argument for that task. When submitting a job to a bare-\/metal service, arguments can be specified a follows.

For each task, an optional argument can be provided as a string formatted as \char`\"{}hostname\+:num\+\_\+cores\char`\"{}, \char`\"{}hostname\char`\"{}, or \char`\"{}num\+\_\+cores\char`\"{}, where \char`\"{}hostname\char`\"{} is the name of one of the service\textquotesingle{}s compute hosts and \char`\"{}num\+\_\+cores\char`\"{} is an integer (e.\+g., \char`\"{}host1\+:10\char`\"{}, \char`\"{}host1\char`\"{}, \char`\"{}10\char`\"{})\+:


\begin{DoxyItemize}
\item If no value is provided for a task, or if the value is the empty string, then the bare-\/metal service will choose the host on which the task should be executed (typically the host with the lowest current load), and will execute the task with as many cores as possible on that host.
\item If a \char`\"{}hostname\char`\"{} value is provided for a task, then the bare-\/metal service will execute the task on that host, and will execute the task with as many cores as possible on that host.
\item If a \char`\"{}num\+\_\+cores\char`\"{} value is provided for a task, then the bare-\/metal service will choose the host on which the task should be executed (typically the host with the lowest current load), and will execute the task with the specified number of cores.
\item If a \char`\"{}hostname\+:num\+\_\+cores\char`\"{} value is provided for a task, then the bare-\/metal service will execute the task on that host with the specified number of cores.
\end{DoxyItemize}

Here is an example submission to the bare-\/metal service created in the above example, for a 4-\/task job for tasks with I\+Ds \char`\"{}task1\char`\"{}, \char`\"{}task2\char`\"{}, \char`\"{}task3\char`\"{}, and \char`\"{}task4\char`\"{}\+:


\begin{DoxyCode}
\textcolor{comment}{// Create a job manager}
\textcolor{keyword}{auto} job\_manager = this->createJobManager();

\textcolor{comment}{// Create a job}
\textcolor{keyword}{auto} job = job\_manager->createStandardJob(
                 \{this->getWorklow()->getTaskByID(\textcolor{stringliteral}{"task1"}),
                  this->getWorklow()->getTaskByID(\textcolor{stringliteral}{"task2"}),
                  this->getWorklow()->getTaskByID(\textcolor{stringliteral}{"task3"}),
                  this->getWorklow()->getTaskByID(\textcolor{stringliteral}{"task4"})\}, \{\});

\textcolor{comment}{// Create service-specific arguments so that:}
\textcolor{comment}{//   task1 will run on host Node1 with as many cores as possible}
\textcolor{comment}{//   task2 will run on host Node2 with 16 cores}
\textcolor{comment}{//   task3 will run on some host with as many cores as possible}
\textcolor{comment}{//   task4 will run on some host with 4 cores}
std::map<std::string, std::string> service\_specific\_args;
service\_specific\_args[\textcolor{stringliteral}{"task1"}] = \textcolor{stringliteral}{"Node1"};
service\_specific\_args[\textcolor{stringliteral}{"task2"}] = \textcolor{stringliteral}{"Node2:16"};
service\_specific\_args[\textcolor{stringliteral}{"task4"}] = \textcolor{stringliteral}{"4"};

\textcolor{comment}{// Submit the job}
job\_manager->submitJob(job, baremetal\_cs, service\_specific\_args);
\end{DoxyCode}
 